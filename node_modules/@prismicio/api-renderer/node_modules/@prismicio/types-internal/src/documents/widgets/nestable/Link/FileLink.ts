import * as t from "io-ts"
import { withFallback } from "io-ts-types"
import { mapOutput } from "io-ts-types/lib/mapOutput"

import { nullable } from "../../../../validators/function"

export const FileLinkType = "FileLink"
export const FileLink = mapOutput(
	t.exact(
		t.intersection([
			t.type({
				id: t.string,
				url: t.string,
				name: t.string,
				kind: t.string,
			}),
			t.partial({
				date: nullable(t.string),
				size: withFallback(t.string, "0"),
			}),
		]),
	),
	(o) => ({ ...o, size: o.size || "0", __TYPE__: FileLinkType } as const),
)

export type FileLink = t.TypeOf<typeof FileLink>
export type FileLinkO = t.OutputOf<typeof FileLink>
export function isFileLink(u: unknown): u is FileLinkO {
	return (u as FileLinkO).__TYPE__ === FileLinkType
}
