import { Chain } from "fp-ts/Either"
import * as t from "io-ts"

import { Link, LinkO } from "./index"

export type LinkContent = {
	__TYPE__: "LinkContent"
	value: LinkO
}

export const LinkContentType = "LinkContent"
export const LinkContent = new t.Type<LinkContent, LinkO>(
	"LinkContent",
	(u): u is LinkContent => {
		return Link.is((u as LinkContent)?.value)
	},
	(u, c) =>
		Chain.chain(Link.validate(u, c), (u) => {
			return t.success({
				value: Link.encode(u),
				__TYPE__: LinkContentType,
			} as const)
		}),
	(linkContent) => Link.encode(linkContent.value),
)
