import * as t from "io-ts"

import { StringOrNull } from "../../../../validators"
import { addType, nullable } from "../../../../validators/function"

export const ExternalLinkType = "ExternalLink"
export const ExternalLink = addType(
	t.exact(
		t.intersection([
			t.type({
				url: t.string,
			}),
			t.partial({
				kind: t.literal("web"),
				target: StringOrNull,
				preview: nullable(
					t.partial({
						title: t.string,
					}),
				),
			}),
		]),
	),
	ExternalLinkType,
)

export type ExternalLink = t.TypeOf<typeof ExternalLink>
export type ExternalLinkO = t.OutputOf<typeof ExternalLink>
export function isExternalLink(u: unknown): u is ExternalLinkO {
	return (u as ExternalLinkO).__TYPE__ === ExternalLinkType
}
