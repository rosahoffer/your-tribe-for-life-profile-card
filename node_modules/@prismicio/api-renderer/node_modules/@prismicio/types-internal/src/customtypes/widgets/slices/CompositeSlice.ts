import * as t from "io-ts"

import { WidgetKey } from "../../../documents/widgets"
import { StringOrNull } from "../../../validators"
import NestableWidget from "../nestable/NestableWidget"
import { SlicesTypes } from "./SlicesTypes"

const CompositeSliceConfig = t.exact(
	t.partial({
		label: StringOrNull,
	}),
)
type CompositeSliceConfig = t.TypeOf<typeof CompositeSliceConfig>

const CompositeSlice = t.exact(
	t.intersection([
		t.type({
			type: t.literal(SlicesTypes.Slice),
		}),
		t.partial({
			fieldset: StringOrNull,
			description: t.string,
			icon: t.string,
			display: t.string,
			"non-repeat": t.record(WidgetKey, NestableWidget),
			repeat: t.record(WidgetKey, NestableWidget),
			config: CompositeSliceConfig,
		}),
	]),
)
type CompositeSlice = t.TypeOf<typeof CompositeSlice>

export default CompositeSlice
