import * as t from "io-ts"

import { StringOrNull } from "../../../validators"
import ImageConstraint from "../shared/ImageConstraint"
import { WidgetTypes } from "../WidgetTypes"

const Thumbnail = t.exact(
	t.intersection([
		t.type({
			name: t.string,
		}),
		ImageConstraint,
	]),
)
type Thumbnail = t.TypeOf<typeof Thumbnail>

const ImageConfig = t.exact(
	t.partial({
		label: StringOrNull,
		placeholder: t.string,
		constraint: ImageConstraint,
		thumbnails: t.readonlyArray(Thumbnail),
	}),
)
type ImageConfig = t.TypeOf<typeof ImageConfig>

const Image = t.exact(
	t.intersection([
		t.type({
			type: t.literal(WidgetTypes.Image),
		}),
		t.partial({
			fieldset: StringOrNull,
			config: ImageConfig,
		}),
	]),
)
type Image = t.TypeOf<typeof Image>

export default Image
