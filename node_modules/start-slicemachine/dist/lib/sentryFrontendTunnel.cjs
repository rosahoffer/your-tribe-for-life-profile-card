"use strict";
Object.defineProperty(exports, Symbol.toStringTag, { value: "Module" });
require('./../_node_modules/@sentry/node/esm/index.cjs');
const index = require('./../_node_modules/node-fetch/src/index.cjs');
const exports$1 = require('./../_node_modules/@sentry/core/esm/exports.cjs');
const sentryFrontendTunnel = async (req, res) => {
  try {
    const envelope = req.body;
    if (envelope) {
      const pieces = envelope.split("\n");
      const header = JSON.parse(pieces[0]);
      const { host, pathname } = new URL(header.dsn);
      const projectId = ((pathname == null ? void 0 : pathname.endsWith("/")) ? pathname.slice(0, -1) : pathname) ?? "";
      const sentryUrl = `https://${host}/api/${projectId}/envelope/`;
      const response = await index.default(sentryUrl, {
        method: "POST",
        body: envelope
      });
      if (!response.ok) {
        const errorMessage = await response.text();
        throw new Error(errorMessage);
      }
    }
  } catch (e) {
    exports$1.captureException(e);
  } finally {
    return res.status(202).send();
  }
};
exports.sentryFrontendTunnel = sentryFrontendTunnel;
//# sourceMappingURL=sentryFrontendTunnel.cjs.map
