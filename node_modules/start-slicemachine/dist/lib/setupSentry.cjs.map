{"version":3,"file":"setupSentry.cjs","sources":["../../../src/lib/setupSentry.ts"],"sourcesContent":["import * as Sentry from \"@sentry/node\";\n\nimport semver from \"semver\";\nimport { PrismicUserProfile, SliceMachineManager } from \"@slicemachine/manager\";\nimport { SENTRY_EXPRESS_DSN } from \"../constants\";\nimport { checkIsSentryEnabled } from \"./checkIsSentryEnabled\";\n\nexport const setupSentry = async (\n\tmanager: SliceMachineManager,\n): Promise<void> => {\n\tif (!checkIsSentryEnabled()) {\n\t\treturn;\n\t}\n\n\tconst sliceMachineVersion =\n\t\tawait manager.versions.getRunningSliceMachineVersion();\n\n\tconst sliceMachineConfig = await manager.project.getSliceMachineConfig();\n\n\tlet userProfile: PrismicUserProfile | undefined;\n\ttry {\n\t\tuserProfile = await manager.user.getProfile();\n\t} catch {\n\t\t// User is not logged in, it doesn't matter\n\t}\n\n\tconst isStableVersion =\n\t\tsemver.prerelease(sliceMachineVersion) === null &&\n\t\tsemver.lte(\"0.1.0\", sliceMachineVersion);\n\n\tSentry.init({\n\t\tdsn: SENTRY_EXPRESS_DSN,\n\t\trelease: sliceMachineVersion,\n\t\tenvironment: isStableVersion\n\t\t\t? import.meta.env.MODE || \"production\"\n\t\t\t: \"alpha\",\n\t});\n\tif (userProfile) {\n\t\tSentry.setUser({ id: userProfile.shortId });\n\t}\n\tSentry.setTag(\"repository\", sliceMachineConfig.repositoryName);\n\tSentry.setContext(\"Repository Data\", {\n\t\tname: sliceMachineConfig.repositoryName,\n\t});\n};\n"],"names":["checkIsSentryEnabled","semver","Sentry.init","SENTRY_EXPRESS_DSN","Sentry.setUser","Sentry.setTag","Sentry.setContext"],"mappings":";;;;;;;;AAOa,MAAA,cAAc,OAC1B,YACkB;AACd,MAAA,CAACA,6CAAwB;AAC5B;AAAA,EACA;AAED,QAAM,sBACL,MAAM,QAAQ,SAAS,8BAA6B;AAErD,QAAM,qBAAqB,MAAM,QAAQ,QAAQ,sBAAqB;AAElE,MAAA;AACA,MAAA;AACW,kBAAA,MAAM,QAAQ,KAAK;UAChC;AAAA,EAED;AAEK,QAAA,kBACLC,MAAO,WAAW,mBAAmB,MAAM,QAC3CA,MAAO,IAAI,SAAS,mBAAmB;AAExCC,WAAY;AAAA,IACX,KAAKC,UAAA;AAAA,IACL,SAAS;AAAA,IACT,aAAa,kBACV,eACA;AAAA,EAAA,CACH;AACD,MAAI,aAAa;AAChBC,cAAAA,QAAe,EAAE,IAAI,YAAY,QAAS,CAAA;AAAA,EAC1C;AACMC,YAAAA,OAAO,cAAc,mBAAmB,cAAc;AAC7DC,YAAAA,WAAkB,mBAAmB;AAAA,IACpC,MAAM,mBAAmB;AAAA,EAAA,CACzB;AACF;;"}