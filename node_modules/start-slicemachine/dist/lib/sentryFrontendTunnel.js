import './../_node_modules/@sentry/node/esm/index.js';
import fetch from './../_node_modules/node-fetch/src/index.js';
import { captureException } from './../_node_modules/@sentry/core/esm/exports.js';
const sentryFrontendTunnel = async (req, res) => {
  try {
    const envelope = req.body;
    if (envelope) {
      const pieces = envelope.split("\n");
      const header = JSON.parse(pieces[0]);
      const { host, pathname } = new URL(header.dsn);
      const projectId = ((pathname == null ? void 0 : pathname.endsWith("/")) ? pathname.slice(0, -1) : pathname) ?? "";
      const sentryUrl = `https://${host}/api/${projectId}/envelope/`;
      const response = await fetch(sentryUrl, {
        method: "POST",
        body: envelope
      });
      if (!response.ok) {
        const errorMessage = await response.text();
        throw new Error(errorMessage);
      }
    }
  } catch (e) {
    captureException(e);
  } finally {
    return res.status(202).send();
  }
};
export {
  sentryFrontendTunnel
};
//# sourceMappingURL=sentryFrontendTunnel.js.map
