{"version":3,"file":"stacktrace.cjs","sources":["../../../../../../../node_modules/@sentry/utils/esm/stacktrace.js"],"sourcesContent":["const STACKTRACE_LIMIT = 50;\n// Used to sanitize webpack (error: *) wrapped stack errors\nconst WEBPACK_ERROR_REGEXP = /\\(error: (.*)\\)/;\n\n/**\n * Creates a stack parser with the supplied line parsers\n *\n * StackFrames are returned in the correct order for Sentry Exception\n * frames and with Sentry SDK internal frames removed from the top and bottom\n *\n */\nfunction createStackParser(...parsers) {\n  const sortedParsers = parsers.sort((a, b) => a[0] - b[0]).map(p => p[1]);\n\n  return (stack, skipFirst = 0) => {\n    const frames = [];\n    for (const line of stack.split('\\n').slice(skipFirst)) {\n      // Ignore lines over 1kb as they are unlikely to be stack frames.\n      // Many of the regular expressions use backtracking which results in run time that increases exponentially with\n      // input size. Huge strings can result in hangs/Denial of Service:\n      // https://github.com/getsentry/sentry-javascript/issues/2286\n      if (line.length > 1024) {\n        continue;\n      }\n\n      // https://github.com/getsentry/sentry-javascript/issues/5459\n      // Remove webpack (error: *) wrappers\n      const cleanedLine = WEBPACK_ERROR_REGEXP.test(line) ? line.replace(WEBPACK_ERROR_REGEXP, '$1') : line;\n\n      for (const parser of sortedParsers) {\n        const frame = parser(cleanedLine);\n\n        if (frame) {\n          frames.push(frame);\n          break;\n        }\n      }\n    }\n\n    return stripSentryFramesAndReverse(frames);\n  };\n}\n\n/**\n * Gets a stack parser implementation from Options.stackParser\n * @see Options\n *\n * If options contains an array of line parsers, it is converted into a parser\n */\nfunction stackParserFromStackParserOptions(stackParser) {\n  if (Array.isArray(stackParser)) {\n    return createStackParser(...stackParser);\n  }\n  return stackParser;\n}\n\n/**\n * @hidden\n */\nfunction stripSentryFramesAndReverse(stack) {\n  if (!stack.length) {\n    return [];\n  }\n\n  let localStack = stack;\n\n  const firstFrameFunction = localStack[0].function || '';\n  const lastFrameFunction = localStack[localStack.length - 1].function || '';\n\n  // If stack starts with one of our API calls, remove it (starts, meaning it's the top of the stack - aka last call)\n  if (firstFrameFunction.indexOf('captureMessage') !== -1 || firstFrameFunction.indexOf('captureException') !== -1) {\n    localStack = localStack.slice(1);\n  }\n\n  // If stack ends with one of our internal API calls, remove it (ends, meaning it's the bottom of the stack - aka top-most call)\n  if (lastFrameFunction.indexOf('sentryWrapped') !== -1) {\n    localStack = localStack.slice(0, -1);\n  }\n\n  // The frame where the crash happened, should be the last entry in the array\n  return localStack\n    .slice(0, STACKTRACE_LIMIT)\n    .map(frame => ({\n      ...frame,\n      filename: frame.filename || localStack[0].filename,\n      function: frame.function || '?',\n    }))\n    .reverse();\n}\n\nconst defaultFunctionName = '<anonymous>';\n\n/**\n * Safely extract function name from itself\n */\nfunction getFunctionName(fn) {\n  try {\n    if (!fn || typeof fn !== 'function') {\n      return defaultFunctionName;\n    }\n    return fn.name || defaultFunctionName;\n  } catch (e) {\n    // Just accessing custom props in some Selenium environments\n    // can cause a \"Permission denied\" exception (see raven-js#495).\n    return defaultFunctionName;\n  }\n}\n\n// eslint-disable-next-line complexity\nfunction node(getModule) {\n  const FILENAME_MATCH = /^\\s*[-]{4,}$/;\n  const FULL_MATCH = /at (?:async )?(?:(.+?)\\s+\\()?(?:(.+):(\\d+):(\\d+)?|([^)]+))\\)?/;\n\n  // eslint-disable-next-line complexity\n  return (line) => {\n    if (line.match(FILENAME_MATCH)) {\n      return {\n        filename: line,\n      };\n    }\n\n    const lineMatch = line.match(FULL_MATCH);\n    if (!lineMatch) {\n      return undefined;\n    }\n\n    let object;\n    let method;\n    let functionName;\n    let typeName;\n    let methodName;\n\n    if (lineMatch[1]) {\n      functionName = lineMatch[1];\n\n      let methodStart = functionName.lastIndexOf('.');\n      if (functionName[methodStart - 1] === '.') {\n        methodStart--;\n      }\n\n      if (methodStart > 0) {\n        object = functionName.slice(0, methodStart);\n        method = functionName.slice(methodStart + 1);\n        const objectEnd = object.indexOf('.Module');\n        if (objectEnd > 0) {\n          functionName = functionName.slice(objectEnd + 1);\n          object = object.slice(0, objectEnd);\n        }\n      }\n      typeName = undefined;\n    }\n\n    if (method) {\n      typeName = object;\n      methodName = method;\n    }\n\n    if (method === '<anonymous>') {\n      methodName = undefined;\n      functionName = undefined;\n    }\n\n    if (functionName === undefined) {\n      methodName = methodName || '<anonymous>';\n      functionName = typeName ? `${typeName}.${methodName}` : methodName;\n    }\n\n    const filename = lineMatch[2] && lineMatch[2].startsWith('file://') ? lineMatch[2].slice(7) : lineMatch[2];\n    const isNative = lineMatch[5] === 'native';\n    const isInternal =\n      isNative || (filename && !filename.startsWith('/') && !filename.startsWith('.') && filename.indexOf(':\\\\') !== 1);\n\n    // in_app is all that's not an internal Node function or a module within node_modules\n    // note that isNative appears to return true even for node core libraries\n    // see https://github.com/getsentry/raven-node/issues/176\n    const in_app = !isInternal && filename !== undefined && !filename.includes('node_modules/');\n\n    return {\n      filename,\n      module: getModule ? getModule(filename) : undefined,\n      function: functionName,\n      lineno: parseInt(lineMatch[3], 10) || undefined,\n      colno: parseInt(lineMatch[4], 10) || undefined,\n      in_app,\n    };\n  };\n}\n\n/**\n * Node.js stack line parser\n *\n * This is in @sentry/utils so it can be used from the Electron SDK in the browser for when `nodeIntegration == true`.\n * This allows it to be used without referencing or importing any node specific code which causes bundlers to complain\n */\nfunction nodeStackLineParser(getModule) {\n  return [90, node(getModule)];\n}\n\nexport { createStackParser, getFunctionName, nodeStackLineParser, stackParserFromStackParserOptions, stripSentryFramesAndReverse };\n//# sourceMappingURL=stacktrace.js.map\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}