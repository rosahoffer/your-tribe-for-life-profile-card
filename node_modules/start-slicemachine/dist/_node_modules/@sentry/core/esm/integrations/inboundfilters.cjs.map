{"version":3,"file":"inboundfilters.cjs","sources":["../../../../../../../../node_modules/@sentry/core/esm/integrations/inboundfilters.js"],"sourcesContent":["import { logger, getEventDescription, stringMatchesSomePattern } from '@sentry/utils';\n\n// \"Script error.\" is hard coded into browsers for errors that it can't read.\n// this is the result of a script being pulled in from an external domain and CORS.\nconst DEFAULT_IGNORE_ERRORS = [/^Script error\\.?$/, /^Javascript error: Script error\\.? on line 0$/];\n\n/** Options for the InboundFilters integration */\n\n/** Inbound filters configurable by the user */\nclass InboundFilters  {\n  /**\n   * @inheritDoc\n   */\n   static __initStatic() {this.id = 'InboundFilters';}\n\n  /**\n   * @inheritDoc\n   */\n   __init() {this.name = InboundFilters.id;}\n\n   constructor(  _options = {}) {this._options = _options;InboundFilters.prototype.__init.call(this);}\n\n  /**\n   * @inheritDoc\n   */\n   setupOnce(addGlobalEventProcessor, getCurrentHub) {\n    const eventProcess = (event) => {\n      const hub = getCurrentHub();\n      if (hub) {\n        const self = hub.getIntegration(InboundFilters);\n        if (self) {\n          const client = hub.getClient();\n          const clientOptions = client ? client.getOptions() : {};\n          const options = _mergeOptions(self._options, clientOptions);\n          return _shouldDropEvent(event, options) ? null : event;\n        }\n      }\n      return event;\n    };\n\n    eventProcess.id = this.name;\n    addGlobalEventProcessor(eventProcess);\n  }\n} InboundFilters.__initStatic();\n\n/** JSDoc */\nfunction _mergeOptions(\n  internalOptions = {},\n  clientOptions = {},\n) {\n  return {\n    allowUrls: [...(internalOptions.allowUrls || []), ...(clientOptions.allowUrls || [])],\n    denyUrls: [...(internalOptions.denyUrls || []), ...(clientOptions.denyUrls || [])],\n    ignoreErrors: [\n      ...(internalOptions.ignoreErrors || []),\n      ...(clientOptions.ignoreErrors || []),\n      ...DEFAULT_IGNORE_ERRORS,\n    ],\n    ignoreInternal: internalOptions.ignoreInternal !== undefined ? internalOptions.ignoreInternal : true,\n  };\n}\n\n/** JSDoc */\nfunction _shouldDropEvent(event, options) {\n  if (options.ignoreInternal && _isSentryError(event)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n      logger.warn(`Event dropped due to being internal Sentry Error.\\nEvent: ${getEventDescription(event)}`);\n    return true;\n  }\n  if (_isIgnoredError(event, options.ignoreErrors)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n      logger.warn(\n        `Event dropped due to being matched by \\`ignoreErrors\\` option.\\nEvent: ${getEventDescription(event)}`,\n      );\n    return true;\n  }\n  if (_isDeniedUrl(event, options.denyUrls)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n      logger.warn(\n        `Event dropped due to being matched by \\`denyUrls\\` option.\\nEvent: ${getEventDescription(\n          event,\n        )}.\\nUrl: ${_getEventFilterUrl(event)}`,\n      );\n    return true;\n  }\n  if (!_isAllowedUrl(event, options.allowUrls)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n      logger.warn(\n        `Event dropped due to not being matched by \\`allowUrls\\` option.\\nEvent: ${getEventDescription(\n          event,\n        )}.\\nUrl: ${_getEventFilterUrl(event)}`,\n      );\n    return true;\n  }\n  return false;\n}\n\nfunction _isIgnoredError(event, ignoreErrors) {\n  if (!ignoreErrors || !ignoreErrors.length) {\n    return false;\n  }\n\n  return _getPossibleEventMessages(event).some(message => stringMatchesSomePattern(message, ignoreErrors));\n}\n\nfunction _isDeniedUrl(event, denyUrls) {\n  // TODO: Use Glob instead?\n  if (!denyUrls || !denyUrls.length) {\n    return false;\n  }\n  const url = _getEventFilterUrl(event);\n  return !url ? false : stringMatchesSomePattern(url, denyUrls);\n}\n\nfunction _isAllowedUrl(event, allowUrls) {\n  // TODO: Use Glob instead?\n  if (!allowUrls || !allowUrls.length) {\n    return true;\n  }\n  const url = _getEventFilterUrl(event);\n  return !url ? true : stringMatchesSomePattern(url, allowUrls);\n}\n\nfunction _getPossibleEventMessages(event) {\n  if (event.message) {\n    return [event.message];\n  }\n  if (event.exception) {\n    try {\n      const { type = '', value = '' } = (event.exception.values && event.exception.values[0]) || {};\n      return [`${value}`, `${type}: ${value}`];\n    } catch (oO) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error(`Cannot extract message for event ${getEventDescription(event)}`);\n      return [];\n    }\n  }\n  return [];\n}\n\nfunction _isSentryError(event) {\n  try {\n    // @ts-ignore can't be a sentry error if undefined\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    return event.exception.values[0].type === 'SentryError';\n  } catch (e) {\n    // ignore\n  }\n  return false;\n}\n\nfunction _getLastValidUrl(frames = []) {\n  for (let i = frames.length - 1; i >= 0; i--) {\n    const frame = frames[i];\n\n    if (frame && frame.filename !== '<anonymous>' && frame.filename !== '[native code]') {\n      return frame.filename || null;\n    }\n  }\n\n  return null;\n}\n\nfunction _getEventFilterUrl(event) {\n  try {\n    let frames;\n    try {\n      // @ts-ignore we only care about frames if the whole thing here is defined\n      frames = event.exception.values[0].stacktrace.frames;\n    } catch (e) {\n      // ignore\n    }\n    return frames ? _getLastValidUrl(frames) : null;\n  } catch (oO) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error(`Cannot extract url for event ${getEventDescription(event)}`);\n    return null;\n  }\n}\n\nexport { InboundFilters, _mergeOptions, _shouldDropEvent };\n//# sourceMappingURL=inboundfilters.js.map\n"],"names":["logger","getEventDescription","stringMatchesSomePattern"],"mappings":"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","x_google_ignoreList":[0]}